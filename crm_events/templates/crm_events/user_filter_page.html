{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Filter & List</title>
    <link rel="stylesheet" href="{% static 'crm_events/style.css' %}">
</head>
<body>
    <div class="container">
        <h1>User Directory</h1>

        <div class="filters-card">
            <h2>Filter Users</h2>
            <div class="filter-group">
                <input type="text" id="companyFilter" placeholder="Company">
                <input type="text" id="jobTitleFilter" placeholder="Job Title">
            </div>
            <div class="filter-group">
                <input type="text" id="cityFilter" placeholder="City">
                <input type="text" id="stateFilter" placeholder="State">
            </div>
            <div class="filter-group">
                <label for="hostingMin">Hosted Events (Min):</label>
                <input type="number" id="hostingMin" placeholder="Min" min="0">
                <label for="hostingMax">Hosted Events (Max):</label>
                <input type="number" id="hostingMax" placeholder="Max" min="0">
            </div>
            <div class="filter-group">
                <label for="registeredMin">Attended Events (Min):</label>
                <input type="number" id="registeredMin" placeholder="Min" min="0">
                <label for="registeredMax">Attended Events (Max):</label>
                <input type="number" id="registeredMax" placeholder="Max" min="0">
            </div>
            <div class="filter-group">
                <label for="sortBy">Sort By:</label>
                <select id="sortBy">
                    <option value="username">Username (Asc)</option>
                    <option value="-username">Username (Desc)</option>
                    <option value="email">Email (Asc)</option>
                    <option value="-email">Email (Desc)</option>
                    <option value="company">Company (Asc)</option>
                    <option value="-company">Company (Desc)</option>
                    <option value="total_hosting_events">Hosted Events (Asc)</option>
                    <option value="-total_hosting_events">Hosted Events (Desc)</option>
                    <option value="total_registered_events">Attended Events (Asc)</option>
                    <option value="-total_registered_events">Attended Events (Desc)</option>
                </select>
            </div>
            <button id="applyFilters">Apply Filters</button>
            <button id="clearFilters">Clear Filters</button>
        </div>

        {# Nút để mở popup email #}
        <button id="openEmailModalBtn" class="open-modal-btn">Send Email to Filtered Users</button>

        {# Modal Container cho form gửi email #}
        <div id="emailModal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>Send Email to Filtered Users</h2>
                <p>Emails will be sent to all users matching the current filters above.</p>
                <div class="form-group">
                    <label for="emailSubjectModal">Subject:</label>
                    <input type="text" id="emailSubjectModal" placeholder="Email Subject" required>
                </div>
                <div class="form-group">
                    <label for="emailBodyModal">Body (Plain Text):</label>
                    <textarea id="emailBodyModal" rows="8" placeholder="Enter plain text email content here..."></textarea>
                </div>
                <div class="form-group">
                    <label for="emailHtmlBodyModal">Body (HTML - Optional):</label>
                    <textarea id="emailHtmlBodyModal" rows="8" placeholder="Enter HTML email content here... (overrides plain text if provided)"></textarea>
                </div>
                <button id="sendEmailBtnModal" class="send-email-btn">Send Email</button>
                <p id="emailStatusMessageModal" style="margin-top: 10px;"></p>
            </div>
        </div>
        {# END Modal Container #}

        <div class="user-list-section">
            <h2>Users</h2>
            <div class="table-responsive">
                <table id="userTable" class="user-table">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Company</th>
                            <th>Job Title</th>
                            <th>City, State</th>
                            <th>Hosted Events</th>
                            <th>Attended Events</th>
                            <th>Joined Date</th>
                        </tr>
                    </thead>
                    <tbody id="userListBody">
                        {# Dữ liệu người dùng sẽ được load bằng JavaScript #}
                    </tbody>
                </table>
            </div>
            <p id="loadingMessage">Loading users...</p>
            <p id="noUsersMessage" style="display: none;">No users found matching your criteria.</p>

            <div class="pagination">
                <button id="prevPage" disabled>&laquo; Previous</button>
                <span id="pageInfo">Page 1</span>
                <button id="nextPage">&raquo; Next</button>
                <label for="pageSizeSelect">Items per page:</label>
                <select id="pageSizeSelect">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
    </div>

    {# Đảm bảo bạn có jQuery #}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="{% static 'crm_events/script.js' %}"></script>

    {# CSRF Token cho AJAX POST requests #}
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
</body>
</html>
